<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../styles/shared-styles.html">

<dom-module id="notifications-team-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
      .notifications paper-item{
        font-size: 12px;
      }
      paper-material{
        padding: 20px;
        background-color: #FFF;
      }
      paper-item-body ::content > * {
        white-space: normal;
      }
      paper-icon-item{
        border-bottom: 1px solid #EEE;
        padding: 10px 0;
      }
      paper-icon-item:first-child{
        padding-top: 0;
      }
      paper-icon-item:last-of-type{
        border-bottom: none;
        padding-bottom: 0;
      }
      .wrapperDiv {
        height:75px;
        width: 100%;
      }
      paper-header-panel {
        background-color:white;
        box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        height:100%;
        margin:12px;
        width:100%;
      }
      .paper-header {
        background-color:#0066A4;
        color:white;
        text-align:center;
        transition:height 0.2s ease 0s;
      }
      .content {
        padding-top:10px;
        text-align:center;
      }
      paper-button.clear {
        font-size: small;
        height: 20px;
        padding-top: 3px;
        position: absolute;
        right: 5px;
        top: 5px;
        width: 40px;
      }
      .navDiv{
        height:auto;
        flex-direction:column;
        justify-content:center;
        padding:0;
        min-width:50px;
      }
      @media (max-width: 900px) {
        #parentDiv{
          font-size: 12px;
          line-height: 12px;
        }
      }
      @media (max-width: 600px) {
        #parentDiv{
          font-size: 10px;
          line-height: 10px;
        }
      }
      /* tablet-small-landscape */
      @media all and (min-width: 600px) and (max-width: 960px) and (orientation: landscape) {
        .navDiv{
          display:none;
        }
        .navDivSmall{
          display:inline-flex;
          justify-content:space-around;
          width:100%;
          height:20px;
        }
      }
      /* tablet-large-landscape */
      @media all and (min-width: 961px) and (orientation: landscape) {
        .navDiv{
          display:inline-flex;
        }
        .navDivSmall{
          display:none;
        }
      }
      /* tablet-small */
      @media all and (min-width: 600px) and (orientation: portrait) {
        .navDiv{
          display:none;
        }
        .navDivSmall{
          display:inline-flex;
          justify-content:space-around;
          width:100%;
          height:20px;
        }
      }
      /* tablet-large */
      @media all and (min-width: 601px) and (max-width: 840px) and (orientation : portrait) {
        .navDiv{
          display:inline-flex;
        }
        .navDivSmall{
          display:none;
        }
      }
      /* desktop-x-small-landscape */
      @media all and (min-width: 0) and (max-width: 480px) and (orientation: landscape) {
        .navDiv{
          display:none;
        }
        .navDivSmall{
          display:inline-flex;
          justify-content:space-around;
          width:100%;
          height:20px;
        }

      }
      /* desktop-x-small */
      @media all and (min-width: 0) and (max-width: 480px) and (max-aspect-ratio: 4/3) {
        .navDiv{
          display:none;
        }
        .navDivSmall{
          display:inline-flex;
          justify-content:space-around;
          width:100%;
          height:20px;
        }

      }
      /* desktop-small-landscape */
      @media all and (min-width: 481px) and (max-width: 840px) and (orientation: landscape) {
        .navDiv{
          display:none;
        }
        .navDivSmall{
          display:inline-flex;
          justify-content:space-around;
          width:100%;
          height:20px;
        }
      }
      /* desktop-small */
      @media all and (min-width: 481px) and (max-width: 840px) and (max-aspect-ratio: 4/3) {
        .navDiv{
          display:none;
        }
        .navDivSmall{
          display:inline-flex;
          justify-content:space-around;
          width:100%;
          height:20px;
        }
      }
      /* desktop-medium-landscape */
      @media all and (min-width: 841px) and (max-width: 1280px) and (orientation: landscape) {
        .navDiv{
          display:inline-flex;
        }
        .navDivSmall{
          display:none;
        }
      }
      /* desktop-medium */
      @media all and (min-width: 841px) and (max-width: 1280px) and (max-aspect-ratio: 4/3) {
        .navDiv{
          display:inline-flex;
        }
        .navDivSmall{
          display:none;
        }
      }
      /* desktop-large */
      @media all and (min-width: 1281px) and (max-width: 1600px) {
        .navDiv{
          display:inline-flex;
        }
        .navDivSmall{
          display:none;
        }
      }
      /* desktop-xlarge */
      @media all and (min-width: 1601px) and (max-width: 1920px) {
        .navDiv{
          display:inline-flex;
        }
        .navDivSmall{
          display:none;
        }
      }
      /* mobile-small */
      @media all and (min-width: 0) and (max-width: 320px) and (orientation: portrait) {
        .navDiv{
          display:none;
        }
        .navDivSmall{
          display:inline-flex;
          justify-content:space-around;
          width:100%;
          height:20px;
        }
      }

      /* mobile-small */
      @media all and (min-width: 321px) and (max-width: 360px) and (orientation: portrait) {
        .navDiv{
          display:none;
        }
        .navDivSmall{
          display:inline-flex;
          justify-content:space-around;
          width:100%;
          height:20px;
        }
      }
      /* mobile-large */
      @media all and (min-width: 361px) and (max-width: 700px) and (orientation: portrait) {
        .navDiv{
          display:inline-flex;
        }
        .navDivSmall{
          display:none;
        }
      }
      /* mobile-small-landscape */
      @media all and (min-width: 0) and (max-width: 480px) and (orientation: landscape) {
        .navDiv{
          display:inline-flex;
        }
        .navDivSmall{
          display:none;
        }
      }
      /* mobile-large-landscape */
      @media all and (min-width: 481px) and (max-width: 800px) and (orientation: landscape) {
        .navDiv{
          display:inline-flex;
        }
        .navDivSmall{
          display:none;
        }
      }

    </style>

    <h2 class="page-title">
    Notification Details
    <template is="dom-if" if="[[hasMultipleNotifications(notificationscount)]]">
        (<span>[[currentPositionPlusOne]]</span> of <span>[[notificationscount]]</span>)
    </template>
    </h2>
    <template is="dom-if" if="[[notificationSelected]]">
    <div id="parentDiv" style="display:flex; justify-content:space-between; width:100%; padding:0; overflow:visible !important;">
      <div class="navDiv" style="width: 40px;">
        <template is="dom-if" if="[[hasLast]]">
          <paper-icon-button on-click="goBack" src="../../images/back.png" title="Previous notification"></paper-icon-button>
        </template>
      </div>
      <div style="flex-grow:4;">
        <br/>
        <table cellpadding="5">
        <tr>
            <td>Description:</td>
            <td><span data-selected-details></span></td>
        </tr>
        <tr>
            <td>Group:</td>
            <td><span data-selected-group></span></td>
        </tr>
        <tr>
            <td>Sent At:</td>
            <td><span data-selected-time></span></td>
        </tr>
        </table>
        <h4>Responses:</h4>
        <div>
          <paper-button raised on-click="deleteNotification">Delete</paper-button>
          <paper-button raised title="View the event history data for this notification" on-click="getData">Go to Data</paper-button>
          <template is="dom-if" if="[[hasNewNotifications]]">
            <paper-button raised on-click="toNextNew" title="Click to see your new notification message">[[notificationString]]</paper-button>
          </template>
        </div>
        <div class="navDivSmall">
          <template is="dom-if" if="[[hasLast]]">
            <paper-icon-button on-click="goBack" src="../../images/back.png" title="Previous notification"></paper-icon-button>
          </template>

          <template is="dom-if" if="[[hasNext]]">
            <paper-icon-button on-click="goForward" src="../../images/forward.png" title="Next notification"></paper-icon-button>
          </template>
        </div>
      </div>
      <div class="navDiv">
        <template is="dom-if" if="[[hasNext]]">
          <paper-icon-button on-click="goForward" src="../../images/forward.png" title="Next notification"></paper-icon-button>
        </template>
      </div>
    </div>
    </template>
    <template is="dom-if" if="[[!notificationSelected]]">
      <paper-material>No notifications to display</paper-material>
    </template>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'notifications-team-view',

        properties: {
          visible: {
            type: Boolean,
            notify: true,
            observer:"_visibleChanged"
          },
          message: {
            type: String,
            value:null
          },
          time: {
            type: String,
            value:null,
            notify:true,
            reflectToAttribute:true
          },
          selectednode:{
            type:String,
            notify:true,
            reflectToAttribute:true
          },
          selecteddetail:{
            type:String,
            notify:true,
            reflectToAttribute:true
          },
          selectedgroup:{
            type:String,
            notify:true,
            reflectToAttribute:true
          },
          route: {
            type: String,
            notify: true,
            reflectToAttribute:true
          },
          currentPosition:{
            type:Number,
            value:0,
            notify:true
          },
          currentPositionPlusOne:{
            type:Number,
            computed:'addOne(currentPosition)'
          },
          hasNext:{
            type:Boolean,
            notify:true,
            computed:'checkHasNext(currentPosition,notificationscount)'
          },
          hasLast:{
            type:Boolean,
            notify:true
          },
          notificationscount:{
            type:Number,
            notify:true
          },
          notificationSelected: {
            type: Boolean,
            value: false,
            computed:'checkHasNotifications(notificationscount)'
          },
          notificationsSinceLoad:{
            type:Number,
            notify:true,
            computed:'checkNotificationsSinceLoad(notificationscount,lastNotificationIndex)'
          },
          notificationString:{
            type:String,
            notify:true,
            computed:'makeNotificationString(notificationsSinceLoad)'
          },
          hasNewNotifications:{
            type:Number,
            notify:true,
            computed:'checkNewNotifications(notificationsSinceLoad)'
          },
          lastNotificationIndex:{
            type:Number,
            notify:true
          }
        },

        _visibleChanged:function(newVal){
          if (!newVal) {
            return;
          }
          this.lastNotificationIndex = bridgeit.notify.getNotificationCount();
          if(this.lastNotificationIndex >= 0){
            this.loadNotification()
          }
        },

        loadNotification: function() {
          if (!bridgeit.notify.selected) {
            return;
          }
          var _this = this;
          bridgeit.notify.clearInjectedNotificationData();
          setTimeout(function(){
            bridgeit.notify.injectNotificationData();
            _this.message = bridgeit.notify.selected.details;
            _this.time = bridgeit.notify.selected.time;
            _this.hasLast = bridgeit.notify.getPreviousNotification() !== null;
            _this.currentPosition = bridgeit.notify.queuePosition == -1? 0:bridgeit.notify.queuePosition;
            if(_this.currentPosition >= _this.lastNotificationIndex){
              _this.lastNotificationIndex = bridgeit.notify.queuePosition + 1;
            }
          },100);
        },

        checkHasNotifications:function(notificationNumber){
          return notificationNumber > 0;
        },

        checkNotificationsSinceLoad:function(current,sinceLoad){
          return current - sinceLoad;
        },

        checkHasNext:function(currentPosition,notificationsCount){
          return currentPosition+1 < notificationsCount;
        },

        makeNotificationString:function(notifications){
          if (notifications === 1){
            return "1 new message"
          }
          else{
            return notifications + " new messages"
          }
        },

        checkNewNotifications:function(notifications){
          return notifications > 0;
        },

        deleteNotification:function(){
          if(this.currentPosition >= this.lastNotificationIndex){
            this.lastNotificationIndex -= 1;
          }
          if(this.hasNext){
            var next = bridgeit.notify.getNextNotification();
            bridgeit.notify.removeSelectedNotification();
            bridgeit.notify.selectNotification(next);
          }
          else if(this.hasLast){
            var back = bridgeit.notify.getPreviousNotification();
            bridgeit.notify.removeSelectedNotification();
            bridgeit.notify.selectNotification(back);
          }
          else{
            bridgeit.notify.removeSelectedNotification();
          }
        },

        goBack:function(){
          bridgeit.notify.selectNotification(bridgeit.notify.getPreviousNotification());
        },

        goForward:function(){
          bridgeit.notify.selectNotification(bridgeit.notify.getNextNotification());
        },

        toNextNew:function(){
          bridgeit.notify.selectNotificationAt(this.lastNotificationIndex);
        },

        addOne:function(index){
          return index+1;
        },

        hasMultipleNotifications: function(count) {
            return count > 1;
        },

        sortNotifications: function(a,b) {
          if (a.time > b.time) { return -1; }
          else if (a.time < b.time) { return 1; }
          return 0;
        },

        getData:function(){
          this.set('selectednode',"");
          this.set('selecteddetail',"");
          this.set('selectedgroup',"");
          var postColon;
          var node, detail, group;
          if(this.message.indexOf('-') !== -1){
            postColon = this.message.split('-')[1];
          }
          else{
            postColon = this.message.split(':')[1];
          }
          node = postColon.split('/')[1].trim();
          detail = postColon.split('/')[2].trim();
          group = postColon.split('/')[0].trim();
          this.set('selectednode', node);
          this.set('selecteddetail', detail);
          this.set('selectedgroup', group);
          var data = document.querySelector("data-view");
          data.historyCheck();
          this.set('route','data');
        }
      });
    })();
  </script>
</dom-module>
